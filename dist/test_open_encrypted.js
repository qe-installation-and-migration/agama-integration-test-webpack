#! /usr/bin/env node
(()=>{var e,t,o,r={86067:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decryptExistingDrive=function(e){(0,r.it)("Should decrypt existitng storage",(async function(){const t=new i.StorageDecryptionPage(r.page);await t.wait(18e4),await t.decrypt(e)}))},t.skipDecryption=function(){(0,r.it)("Should skip decryption for encrypted storage",(async function(){const e=new i.StorageDecryptionPage(r.page);await e.skip()}))};const r=o(12229),i=o(69756)},281:function(e,t,o){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logIn=function(e){(0,s.it)("should have Agama page title",(async function(){i.default.deepEqual(await s.page.title(),"Agama")})),(0,s.it)("should allow logging in",(async function(){const t=new a.LoginAsRootPage(s.page);await t.fillPassword(e),await t.logIn()}))};const i=r(o(97703)),s=o(12229),a=o(32056)},78730:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.productSelectionByName=function(e){(0,r.it)(`should allow to select product ${e}`,(async function(){await new s.ProductSelectionPage(r.page).selectByName(e)})),a()},t.productSelection=function(e){(0,r.it)(`should allow to select product ${e}`,(async function(){await new s.ProductSelectionPage(r.page).select(e)})),a()},t.productSelectionWithLicense=function(e){(0,r.it)(`should allow to select product ${e} accepting its license`,(async function(){await new s.ProductSelectionWithRegistrationPage(r.page).select(e)})),a()};const r=o(12229),i=o(3320),s=o(73711);function a(){(0,r.it)("should start configuring the product",(async function(){await new i.ConfiguringProductPage(r.page).wait()}))}},28197:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkDestructiveActions=function(){(0,r.it)("should have correct destructive actions",(async function(){const e=new s.StoragePage(r.page),t=new i.SidebarPage(r.page);await t.goToStorage(),await e.verifyDecrytDestructiveActions()}))};const r=o(12229),i=o(24829),s=o(97278)},13378:function(e,t,o){"use strict";var r,i=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,i)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=r(e),a=0;a<o.length;a++)"default"!==o[a]&&i(t,e,o[a]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){const t=n.program.description("Run a simple Agama integration test").option("-u, --url <url>","Agama server URL","http://localhost").option("-p, --password <password>","Agama login password","linux").addOption(new n.Option("-b, --browser <browser>","Browser used for running the test").choices(["firefox","chrome","chromium"]).default("firefox")).option("-r, --root-password <password>","Target root login password","linux").option("-h, --headed","Run the browser in headed mode with UI (the default is headless mode)").addOption(new n.Option("-d, --delay <miliseconds>","Delay between the browser actions, useful in headed mode").argParser(l).default(0)).option("-c, --continue","Continue the test after a failure (the default is abort on error)",!1);return e&&e(t),t.parse(process.argv),(0,u.setContinueOnError)(n.program.opts().continue),n.program.opts()};const n=o(62116),c=a(o(62116)),u=o(12229);function l(e){const t=parseInt(e,10);if(isNaN(t))throw new c.InvalidArgumentError("Enter a valid number.");return t}},12229:function(e,t,o){"use strict";var r,i=this&&this.__createBinding||(Object.create?function(e,t,o,r){void 0===r&&(r=o);var i=Object.getOwnPropertyDescriptor(t,o);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,r,i)}:function(e,t,o,r){void 0===r&&(r=o),e[r]=t[o]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(r=function(e){return r=Object.getOwnPropertyNames||function(e){var t=[];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[t.length]=o);return t},r(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var o=r(e),a=0;a<o.length;a++)"default"!==o[a]&&i(t,e,o[a]);return s(t,e),t}),n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Desktop=t.ProductId=t.page=void 0,t.startBrowser=b,t.finishBrowser=P,t.test_init=function(e){(0,f.before)((async function(){({page:t.page}=await b(!e.headed,e.slowMo,e.browser,e.url))})),(0,f.after)((async function(){await P()}))},t.setContinueOnError=function(e){m=e},t.dumpPage=S,t.it=async function(e,o,r){(0,f.it)(e,{timeout:r||6e4},(async r=>{try{x?r.skip():await o()}catch(o){throw m||(x=!0),t.page&&(c.default.existsSync(y)||c.default.mkdirSync(y),await Promise.allSettled([S(e),_()])),new Error("Test failed!",{cause:o})}}))},t.sleep=function(e){return new Promise((t=>setTimeout(t,e)))};const c=n(o(79896)),u=n(o(16928)),l=n(o(58611)),p=n(o(65692)),d=n(o(43106)),g=a(o(79796)),f=o(22579);let h,w;const y="log";function v(e){switch(e.toLowerCase()){case"firefox":return{product:"firefox",executablePath:"/usr/bin/firefox"};case"chrome":return{product:"chrome",executablePath:"/usr/bin/google-chrome-stable"};case"chromium":return{product:"chrome",executablePath:"/usr/bin/chromium"};default:throw new Error(`Unsupported browser type: ${e}`)}}async function b(e,o,r,i){return w=i,h=await g.launch({protocol:"webDriverBiDi",headless:e,ignoreHTTPSErrors:!0,timeout:3e4,slowMo:o,defaultViewport:{width:1280,height:800},...v(r)}),t.page=await h.newPage(),t.page.setDefaultTimeout(2e4),await t.page.goto(i,{timeout:6e4,waitUntil:"domcontentloaded"}),{page:t.page,browser:h}}async function P(){t.page&&await t.page.close(),h&&await h.close()}let x=!1,m=!1;async function _(){const e=[],t=w.startsWith("https://")?p.default:l.default;return new Promise(((o,r)=>{t.get(w+"/index.css",{rejectUnauthorized:!1,headers:{"Accept-Encoding":"gzip"}},(t=>{t.on("data",(t=>{e.push(Buffer.from(t,"binary"))})),t.on("end",(()=>{const i=Buffer.concat(e),s=y+"/index.css";"gzip"===t.headers["content-encoding"]?d.default.gunzip(i,((e,t)=>{e?(console.error("Cannot decompress index.css: ",e.cause),r(e.cause)):(c.default.writeFileSync(s,t),o(s))})):(c.default.writeFileSync(s,i),o(s))}))})).on("error",(e=>{console.error("Cannot download index.css: ",e),r(e)}))}))}async function S(e){const o=u.default.join(y,e.replace(/[^a-zA-Z0-9]/g,"_"));await t.page.screenshot({path:o+".png"});const r=await t.page.content();c.default.writeFileSync(o+".html",r)}var O,k;!function(e){e["Leap_16.0"]="Leap 16.0",e.MicroOS="openSUSE MicroOS",e["SLES_16.0"]="SUSE Linux Enterprise Server 16.0",e["SLES_SAP_16.0"]="SUSE Linux Enterprise Server for SAP Applications 16.0",e.Slowroll="Slowroll",e.Tumbleweed="openSUSE Tumbleweed",e.None="none"}(O||(t.ProductId=O={})),function(e){e.gnome="GNOME Desktop Environment (Wayland)",e.kde="KDE Applications and Plasma Desktop",e.xfce="XFCE Desktop Environment",e.basic="A basic desktop (based on IceWM)",e.none="None"}(k||(t.Desktop=k={}))},3320:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfiguringProductPage=void 0,t.ConfiguringProductPage=class{page;configuringTheProductText=()=>this.page.locator("::-p-text(Configuring the product)");constructor(e){this.page=e}async wait(){await this.configuringTheProductText().wait()}}},32056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginAsRootPage=void 0,t.LoginAsRootPage=class{page;passwordInput=()=>this.page.locator("input#password");logInButton=()=>this.page.locator("button[type='submit']");constructor(e){this.page=e}async fillPassword(e){await this.passwordInput().fill(e)}async logIn(){await this.logInButton().click()}}},73711:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProductSelectionWithRegistrationPage=t.ProductSelectionPage=void 0;class o{page;productText=e=>this.page.locator(`::-p-text(${e})`);productId=e=>this.page.locator(`input#${e}`);selectButton=()=>this.page.locator("button[form='productSelectionForm']");constructor(e){this.page=e}async choose(e){(await this.productId(e).waitHandle()).scrollIntoView(),await this.productId(e).click()}async select(e){await this.choose(e),await this.selectButton().click()}async selectByName(e){await this.choose(e),await this.selectButton().click()}}t.ProductSelectionPage=o;class r extends(function(e){return class extends e{licenseAcceptanceCheckbox=()=>this.page.locator("::-p-text(I have read and)");async acceptLicense(){await this.licenseAcceptanceCheckbox().click()}async select(e){await this.choose(e),await this.acceptLicense(),await this.selectButton().click()}}}(o)){}t.ProductSelectionWithRegistrationPage=r},24829:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SidebarWithRegistrationPage=t.SidebarPage=void 0;class o{page;overviewLink=()=>this.page.locator("a[href='#/overview']");overviewText=()=>this.page.locator("h3::-p-text('Overview')");localizationLink=()=>this.page.locator("a[href='#/l10n']");networkLink=()=>this.page.locator("a[href='#/network']");storageLink=()=>this.page.locator("a[href='#/storage']");softwareLink=()=>this.page.locator("a[href='#/software']");usersLink=()=>this.page.locator("a[href='#/users']");constructor(e){this.page=e}async goToOverview(){await this.overviewLink().click()}async waitOverviewVisible(e){await this.overviewText().setTimeout(e).wait()}async goToLocalization(){await this.localizationLink().click()}async goToNetwork(){await this.networkLink().click()}async goToStorage(){await this.storageLink().click()}async goToSoftware(){await this.softwareLink().click()}async goToUsers(){await this.usersLink().click()}}t.SidebarPage=o;class r extends(function(e){return class extends e{registrationLink=()=>this.page.locator("a[href='#/registration']");async goToRegistration(){await this.registrationLink().click()}}}(o)){}t.SidebarWithRegistrationPage=r},69756:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageDecryptionPage=void 0,t.StorageDecryptionPage=class{page;passwordInput=()=>this.page.locator("input#luks-password");skipButton=()=>this.page.locator("button::-p-text(Skip)");decryptButton=()=>this.page.locator("button::-p-text(Decrypt)");constructor(e){this.page=e}async wait(e){await this.passwordInput().setTimeout(e).wait()}async decrypt(e){await this.passwordInput().fill(e),await this.decryptButton().click()}async skip(){await this.skipButton().click()}}},97278:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoragePage=void 0,t.StoragePage=class{page;changeInstallationDeviceButton=()=>this.page.locator("a[href='#/storage/target-device']");enableButton=()=>this.page.locator("button::-p-text(Enable)");enabledDiv=()=>this.page.locator("div::-p-text(enabled)");decryptDestructiveActions=()=>this.page.locator("h4::-p-text(There are 6 destructive actions planned)");constructor(e){this.page=e}async enableEncryption(){await this.enableButton().click()}async changeInstallationDevice(){await this.changeInstallationDeviceButton().click()}async verifyEncryptionEnabled(){await this.enabledDiv().wait()}async verifyDecrytDestructiveActions(){await this.decryptDestructiveActions().wait()}}},39182:(e,t,o)=>{"use strict";const r=o(13378),i=o(12229),s=o(281),a=o(86067),n=o(28197),c=o(78730),u=(0,r.parse)((e=>e.option("--product-id <id>","Product id to select a product to install","none").option("--accept-license","Accept license for a product with license (the default is a product without license)").option("--registration-code <code>","Registration code").option("--install","Proceed to install the system (the default is not to install it)").option("--dasd","Prepare DASD storage (the default is not to prepare it)")));(0,i.test_init)(u),(0,s.logIn)(u.password),"none"!==u.productId&&(u.acceptLicense?(0,c.productSelectionWithLicense)(u.productId):(0,c.productSelection)(u.productId)),(0,a.decryptExistingDrive)(u.password),(0,n.checkDestructiveActions)()},53802:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=53802,e.exports=t},84655:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=84655,e.exports=t},42613:e=>{"use strict";e.exports=require("assert")},20181:e=>{"use strict";e.exports=require("buffer")},35317:e=>{"use strict";e.exports=require("child_process")},76982:e=>{"use strict";e.exports=require("crypto")},72250:e=>{"use strict";e.exports=require("dns")},24434:e=>{"use strict";e.exports=require("events")},79896:e=>{"use strict";e.exports=require("fs")},91943:e=>{"use strict";e.exports=require("fs/promises")},58611:e=>{"use strict";e.exports=require("http")},65692:e=>{"use strict";e.exports=require("https")},69278:e=>{"use strict";e.exports=require("net")},97703:e=>{"use strict";e.exports=require("node:assert/strict")},31421:e=>{"use strict";e.exports=require("node:child_process")},78474:e=>{"use strict";e.exports=require("node:events")},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},1708:e=>{"use strict";e.exports=require("node:process")},22579:e=>{"use strict";e.exports=require("node:test")},70857:e=>{"use strict";e.exports=require("os")},16928:e=>{"use strict";e.exports=require("path")},932:e=>{"use strict";e.exports=require("process")},23785:e=>{"use strict";e.exports=require("readline")},2203:e=>{"use strict";e.exports=require("stream")},64756:e=>{"use strict";e.exports=require("tls")},52018:e=>{"use strict";e.exports=require("tty")},87016:e=>{"use strict";e.exports=require("url")},39023:e=>{"use strict";e.exports=require("util")},43106:e=>{"use strict";e.exports=require("zlib")}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var o=i[e]={id:e,loaded:!1,exports:{}};return r[e].call(o.exports,o,o.exports,s),o.loaded=!0,o.exports}s.m=r,s.c=i,s.x=()=>{var e=s.O(void 0,[121],(()=>s(s.s=39182)));return s.O(e)},e=[],s.O=(t,o,r,i)=>{if(!o){var a=1/0;for(l=0;l<e.length;l++){for(var[o,r,i]=e[l],n=!0,c=0;c<o.length;c++)(!1&i||a>=i)&&Object.keys(s.O).every((e=>s.O[e](o[c])))?o.splice(c--,1):(n=!1,i<a&&(a=i));if(n){e.splice(l--,1);var u=r();void 0!==u&&(t=u)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[o,r,i]},s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,o)=>(s.f[o](e,t),t)),[])),s.u=e=>"vendor.js",s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o={267:1},s.O.require=e=>o[e],s.f.require=(e,t)=>{o[e]||(e=>{var t=e.modules,r=e.ids,i=e.runtime;for(var a in t)s.o(t,a)&&(s.m[a]=t[a]);i&&i(s);for(var n=0;n<r.length;n++)o[r[n]]=1;s.O()})(require("./"+s.u(e)))},t=s.x,s.x=()=>(s.e(121),t()),s.x()})();
//# sourceMappingURL=test_open_encrypted.js.map