#! /usr/bin/env node
(()=>{var e,t,r,o={42079:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.enableEncryption=function(e){(0,o.it)("should enable encryption",(async function(){const t=new n.StoragePage(o.page),r=new a.StorageEncryptionPage(o.page),s=new i.SidebarPage(o.page);await s.goToStorage(),await t.enableEncryption(),await r.encrypt(e),await t.verifyEncryptionEnabled()}))};const o=r(12229),i=r(24829),a=r(47332),n=r(97278)},52850:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.performInstallation=function(){(0,o.it)("should start installation",(async function(){const e=new i.ConfirmInstallationPage(o.page),t=new n.OverviewPage(o.page),r=new s.SidebarPage(o.page);await r.goToOverview(),await t.install(),await e.continue()})),(0,o.it)("should finish installation",(async function(){await new a.CongratulationPage(o.page).wait(84e4)}),9e5)},t.finishInstallation=function(){(0,o.it)("should finish",(async function(){const e=new a.CongratulationPage(o.page);await e.wait(84e4)}),9e5)};const o=r(12229),i=r(29830),a=r(48327),n=r(66788),s=r(24829)},281:function(e,t,r){"use strict";var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logIn=function(e){(0,a.it)("should have Agama page title",(async function(){i.default.deepEqual(await a.page.title(),"Agama")})),(0,a.it)("should allow logging in",(async function(){const t=new n.LoginAsRootPage(a.page);await t.fillPassword(e),await t.logIn()}))};const i=o(r(97703)),a=r(12229),n=r(32056)},13378:function(e,t,r){"use strict";var o,i=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&i(t,e,r[n]);return a(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){const t=s.program.description("Run a simple Agama integration test").option("-u, --url <url>","Agama server URL","http://localhost").option("-p, --password <password>","Agama login password","linux").addOption(new s.Option("-b, --browser <browser>","Browser used for running the test").choices(["firefox","chrome","chromium"]).default("firefox")).option("-r, --root-password <password>","Target root login password","linux").option("-h, --headed","Run the browser in headed mode with UI (the default is headless mode)").addOption(new s.Option("-d, --delay <miliseconds>","Delay between the browser actions, useful in headed mode").argParser(l).default(0)).option("-c, --continue","Continue the test after a failure (the default is abort on error)",!1);return e&&e(t),t.parse(process.argv),(0,u.setContinueOnError)(s.program.opts().continue),s.program.opts()};const s=r(62116),c=n(r(62116)),u=r(12229);function l(e){const t=parseInt(e,10);if(isNaN(t))throw new c.InvalidArgumentError("Enter a valid number.");return t}},12229:function(e,t,r){"use strict";var o,i=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||(o=function(e){return o=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},o(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=o(e),n=0;n<r.length;n++)"default"!==r[n]&&i(t,e,r[n]);return a(t,e),t}),s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Desktop=t.ProductId=t.page=void 0,t.startBrowser=b,t.finishBrowser=m,t.test_init=function(e){(0,f.before)((async function(){({page:t.page}=await b(!e.headed,e.slowMo,e.browser,e.url))})),(0,f.after)((async function(){await m()}))},t.setContinueOnError=function(e){P=e},t.dumpPage=_,t.it=async function(e,r,o){(0,f.it)(e,{timeout:o||6e4},(async o=>{try{x?o.skip():await r()}catch(r){throw P||(x=!0),t.page&&(c.default.existsSync(v)||c.default.mkdirSync(v),await Promise.allSettled([_(e),O()])),new Error("Test failed!",{cause:r})}}))},t.sleep=function(e){return new Promise((t=>setTimeout(t,e)))};const c=s(r(79896)),u=s(r(16928)),l=s(r(58611)),p=s(r(65692)),d=s(r(43106)),g=n(r(79796)),f=r(22579);let h,w;const v="log";function y(e){switch(e.toLowerCase()){case"firefox":return{product:"firefox",executablePath:"/usr/bin/firefox"};case"chrome":return{product:"chrome",executablePath:"/usr/bin/google-chrome-stable"};case"chromium":return{product:"chrome",executablePath:"/usr/bin/chromium"};default:throw new Error(`Unsupported browser type: ${e}`)}}async function b(e,r,o,i){return w=i,h=await g.launch({protocol:"webDriverBiDi",headless:e,ignoreHTTPSErrors:!0,timeout:3e4,slowMo:r,defaultViewport:{width:1280,height:800},...y(o)}),t.page=await h.newPage(),t.page.setDefaultTimeout(2e4),await t.page.goto(i,{timeout:6e4,waitUntil:"domcontentloaded"}),{page:t.page,browser:h}}async function m(){t.page&&await t.page.close(),h&&await h.close()}let x=!1,P=!1;async function O(){const e=[],t=w.startsWith("https://")?p.default:l.default;return new Promise(((r,o)=>{t.get(w+"/index.css",{rejectUnauthorized:!1,headers:{"Accept-Encoding":"gzip"}},(t=>{t.on("data",(t=>{e.push(Buffer.from(t,"binary"))})),t.on("end",(()=>{const i=Buffer.concat(e),a=v+"/index.css";"gzip"===t.headers["content-encoding"]?d.default.gunzip(i,((e,t)=>{e?(console.error("Cannot decompress index.css: ",e.cause),o(e.cause)):(c.default.writeFileSync(a,t),r(a))})):(c.default.writeFileSync(a,i),r(a))}))})).on("error",(e=>{console.error("Cannot download index.css: ",e),o(e)}))}))}async function _(e){const r=u.default.join(v,e.replace(/[^a-zA-Z0-9]/g,"_"));await t.page.screenshot({path:r+".png"});const o=await t.page.content();c.default.writeFileSync(r+".html",o)}var S,k;!function(e){e["Leap_16.0"]="Leap 16.0",e.MicroOS="openSUSE MicroOS",e["SLES_16.0"]="SUSE Linux Enterprise Server 16.0",e["SLES_SAP_16.0"]="SUSE Linux Enterprise Server for SAP Applications 16.0",e.Slowroll="Slowroll",e.Tumbleweed="openSUSE Tumbleweed",e.None="none"}(S||(t.ProductId=S={})),function(e){e.gnome="GNOME Desktop Environment (Wayland)",e.kde="KDE Applications and Plasma Desktop",e.xfce="XFCE Desktop Environment",e.basic="A basic desktop (based on IceWM)",e.none="None"}(k||(t.Desktop=k={}))},29830:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfirmInstallationPage=void 0,t.ConfirmInstallationPage=class{page;continueButton=()=>this.page.locator("button::-p-text('Continue')");constructor(e){this.page=e}async continue(){await this.continueButton().click()}}},48327:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CongratulationPage=void 0,t.CongratulationPage=class{page;congratulationText=()=>this.page.locator("h2::-p-text('Congratulations!')");constructor(e){this.page=e}async wait(e){await this.congratulationText().setTimeout(e).wait()}}},32056:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginAsRootPage=void 0,t.LoginAsRootPage=class{page;passwordInput=()=>this.page.locator("input#password");logInButton=()=>this.page.locator("button[type='submit']");constructor(e){this.page=e}async fillPassword(e){await this.passwordInput().fill(e)}async logIn(){await this.logInButton().click()}}},66788:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewPage=void 0,t.OverviewPage=class{page;warningAlert=()=>this.page.locator("::-p-text(Warning alert)");installButton=()=>this.page.locator("button::-p-text(Install)");constructor(e){this.page=e}async waitWarningAlertToDisappear(){await this.warningAlert().setVisibility("hidden").wait()}async install(){await this.installButton().click()}}},24829:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SidebarWithRegistrationPage=t.SidebarPage=void 0;class r{page;overviewLink=()=>this.page.locator("a[href='#/overview']");overviewText=()=>this.page.locator("h3::-p-text('Overview')");localizationLink=()=>this.page.locator("a[href='#/l10n']");networkLink=()=>this.page.locator("a[href='#/network']");storageLink=()=>this.page.locator("a[href='#/storage']");softwareLink=()=>this.page.locator("a[href='#/software']");usersLink=()=>this.page.locator("a[href='#/users']");constructor(e){this.page=e}async goToOverview(){await this.overviewLink().click()}async waitOverviewVisible(e){await this.overviewText().setTimeout(e).wait()}async goToLocalization(){await this.localizationLink().click()}async goToNetwork(){await this.networkLink().click()}async goToStorage(){await this.storageLink().click()}async goToSoftware(){await this.softwareLink().click()}async goToUsers(){await this.usersLink().click()}}t.SidebarPage=r;class o extends(function(e){return class extends e{registrationLink=()=>this.page.locator("a[href='#/registration']");async goToRegistration(){await this.registrationLink().click()}}}(r)){}t.SidebarWithRegistrationPage=o},47332:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageEncryptionPage=void 0,t.StorageEncryptionPage=class{page;encryptTheSystemCheckbox=()=>this.page.locator("label[class='pf-v5-c-switch'] > input[type='checkbox']");passwordInput=()=>this.page.locator("#password");passwordConfirmationInput=()=>this.page.locator("#passwordConfirmation");acceptButton=()=>this.page.locator("button::-p-text(Accept)");constructor(e){this.page=e}async encrypt(e){await this.encryptTheSystemCheckbox().click(),await this.passwordInput().fill(e),await this.passwordConfirmationInput().fill(e),await this.acceptButton().click()}}},97278:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StoragePage=void 0,t.StoragePage=class{page;changeInstallationDeviceButton=()=>this.page.locator("a[href='#/storage/target-device']");enableButton=()=>this.page.locator("button::-p-text(Enable)");enabledDiv=()=>this.page.locator("div::-p-text(enabled)");decryptDestructiveActions=()=>this.page.locator("h4::-p-text(There are 6 destructive actions planned)");constructor(e){this.page=e}async enableEncryption(){await this.enableButton().click()}async changeInstallationDevice(){await this.changeInstallationDeviceButton().click()}async verifyEncryptionEnabled(){await this.enabledDiv().wait()}async verifyDecrytDestructiveActions(){await this.decryptDestructiveActions().wait()}}},30672:(e,t,r)=>{"use strict";const o=r(13378),i=r(12229),a=r(42079),n=r(281),s=r(52850),c=(0,o.parse)((e=>e.option("--install","Proceed to install the system (the default is not to install it)")));(0,i.test_init)(c),(0,n.logIn)(c.password),(0,a.enableEncryption)(c.password),c.install&&(0,s.performInstallation)()},53802:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=53802,e.exports=t},84655:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=84655,e.exports=t},42613:e=>{"use strict";e.exports=require("assert")},20181:e=>{"use strict";e.exports=require("buffer")},35317:e=>{"use strict";e.exports=require("child_process")},76982:e=>{"use strict";e.exports=require("crypto")},72250:e=>{"use strict";e.exports=require("dns")},24434:e=>{"use strict";e.exports=require("events")},79896:e=>{"use strict";e.exports=require("fs")},91943:e=>{"use strict";e.exports=require("fs/promises")},58611:e=>{"use strict";e.exports=require("http")},65692:e=>{"use strict";e.exports=require("https")},69278:e=>{"use strict";e.exports=require("net")},97703:e=>{"use strict";e.exports=require("node:assert/strict")},31421:e=>{"use strict";e.exports=require("node:child_process")},78474:e=>{"use strict";e.exports=require("node:events")},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},1708:e=>{"use strict";e.exports=require("node:process")},22579:e=>{"use strict";e.exports=require("node:test")},70857:e=>{"use strict";e.exports=require("os")},16928:e=>{"use strict";e.exports=require("path")},932:e=>{"use strict";e.exports=require("process")},23785:e=>{"use strict";e.exports=require("readline")},2203:e=>{"use strict";e.exports=require("stream")},64756:e=>{"use strict";e.exports=require("tls")},52018:e=>{"use strict";e.exports=require("tty")},87016:e=>{"use strict";e.exports=require("url")},39023:e=>{"use strict";e.exports=require("util")},43106:e=>{"use strict";e.exports=require("zlib")}},i={};function a(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={id:e,loaded:!1,exports:{}};return o[e].call(r.exports,r,r.exports,a),r.loaded=!0,r.exports}a.m=o,a.c=i,a.x=()=>{var e=a.O(void 0,[121],(()=>a(a.s=30672)));return a.O(e)},e=[],a.O=(t,r,o,i)=>{if(!r){var n=1/0;for(l=0;l<e.length;l++){for(var[r,o,i]=e[l],s=!0,c=0;c<r.length;c++)(!1&i||n>=i)&&Object.keys(a.O).every((e=>a.O[e](r[c])))?r.splice(c--,1):(s=!1,i<n&&(n=i));if(s){e.splice(l--,1);var u=o();void 0!==u&&(t=u)}}return t}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[r,o,i]},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,r)=>(a.f[r](e,t),t)),[])),a.u=e=>"vendor.js",a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),r={849:1},a.O.require=e=>r[e],a.f.require=(e,t)=>{r[e]||(e=>{var t=e.modules,o=e.ids,i=e.runtime;for(var n in t)a.o(t,n)&&(a.m[n]=t[n]);i&&i(a);for(var s=0;s<o.length;s++)r[o[s]]=1;a.O()})(require("./"+a.u(e)))},t=a.x,a.x=()=>(a.e(121),t()),a.x()})();
//# sourceMappingURL=test_full_disk_encryption.js.map